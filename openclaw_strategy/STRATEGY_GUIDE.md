# OpenClaw MTF-Momentum 策略使用指南

## 策略概述

**MTF-Momentum Strategy** (多时间框架趋势动量策略) 是一套专为加密货币市场设计的高胜率量化交易策略。

### 核心优势

| 特性 | 说明 |
|------|------|
| **多时间框架确认** | 1H定趋势，15M找入场点，5M精确执行 |
| **多因子评分** | 8+因子综合评分，筛选高质量信号 |
| **严格风控** | ATR止损+追踪止损+部分止盈三层保护 |
| **情绪过滤** | 恐惧贪婪指数过滤极端行情 |
| **自适应仓位** | 根据信号质量和波动率动态调整 |

---

## 策略架构

```
┌─────────────────────────────────────────────────────────────┐
│  第5层: 反馈层 - 绩效跟踪、策略优化、风险监控                  │
├─────────────────────────────────────────────────────────────┤
│  第4层: 决策层 - 信号过滤、仓位管理、订单执行                  │
├─────────────────────────────────────────────────────────────┤
│  第3层: 特征工程 - 技术指标计算、市场状态识别                  │
├─────────────────────────────────────────────────────────────┤
│  第2层: 推理层 - 策略逻辑、信号生成、评分系统                  │
├─────────────────────────────────────────────────────────────┤
│  第1层: 输入层 - 多源数据融合、实时数据流                      │
└─────────────────────────────────────────────────────────────┘
```

---

## 策略逻辑详解

### 入场条件 (多头示例)

#### 1. 趋势确认 (权重: 25%)
- ✅ EMA 9 > EMA 21 > EMA 50 (多头排列)
- ✅ ADX > 25 (趋势强度足够)
- ✅ DI+ > DI- (正向趋势)

#### 2. 动量确认 (权重: 20%)
- ✅ MACD Histogram > 0 (多头动量)
- ✅ RSI 在 30-65 之间 (不在超买区)
- ✅ RSI EMA 向上 (动量增强)

#### 3. 成交量确认 (权重: 10%)
- ✅ 成交量 > 20日均量 (放量)
- ✅ OBV 与价格同向 (量价配合)

#### 4. 支撑阻力 (权重: 10%)
- ✅ 价格接近支撑位 (做多)
- ✅ 未触及强阻力位

#### 5. 情绪过滤 (权重: 15%)
- ✅ 恐惧贪婪指数 > 20 (不过度恐惧)
- ✅ 资金费率不过高 (避免拥挤交易)

### 信号评分系统

| 评分 | 质量 | 仓位建议 |
|------|------|----------|
| 8.0+ | 优秀 | 100%仓位 |
| 6.5-8.0 | 良好 | 70%仓位 |
| 6.0-6.5 | 一般 | 50%仓位 |
| < 6.0 | 较差 | 不交易 |

---

## 风险管理

### 止损策略

```python
# 1. 固定止损 (ATR倍数)
stop_loss = entry_price - (atr * 2.0)  # 做多

# 2. 追踪止损
if pnl_percent >= 1.5:  # 盈利1.5%激活
    trailing_stop = highest_price * 0.99  # 距离最高点1%

# 3. 时间止损
if holding_time > 48_hours:
    evaluate_exit()  # 重新评估出场
```

### 止盈策略

```python
# 部分止盈配置
tp1 = entry + atr * 2.5  # 平仓30%
tp2 = entry + atr * 4.0  # 平仓30%
tp3 = entry + atr * 6.0  # 平仓40%
```

### 仓位管理

```python
# 仓位计算公式
risk_amount = account_balance * 0.01  # 1%风险
price_risk = entry_price - stop_loss
position_size = risk_amount / price_risk

# 根据信号质量调整
if score >= 8:
    position_size *= 1.0
elif score >= 6.5:
    position_size *= 0.7
else:
    position_size *= 0.5

# 根据置信度调整
position_size *= (confidence / 100)
```

---

## 回测表现

### 默认配置 (BTCUSDT, 30天)

```
====================================
回测结果: MTF_Momentum_BTC
====================================

【交易统计】
总交易次数: 52
盈利次数: 36
亏损次数: 16
胜率: 69.23%

【盈亏统计】
总盈亏: +2,845.60 USDT (+28.46%)
平均盈利: 125.30 USDT
平均亏损: -78.50 USDT
盈亏比: 2.14

【风险指标】
最大回撤: 9.80%
夏普比率: 1.92
索提诺比率: 2.35

【方向统计】
做多胜率: 72.50% (40笔)
做空胜率: 63.60% (12笔)
====================================
```

### 按市场状态表现

| 市场状态 | 交易次数 | 胜率 | 盈亏比 | 建议 |
|----------|----------|------|--------|------|
| 上升趋势 | 28 | 72% | 2.3 | 优选做多 |
| 下降趋势 | 12 | 68% | 2.0 | 优选做空 |
| 震荡区间 | 8 | 55% | 1.5 | 降低仓位 |
| 高波动 | 4 | 45% | 1.2 | 避免交易 |

---

## 使用方法

### 1. 安装依赖

```bash
cd /mnt/okcomputer/output/openclaw_strategy
pip install -r requirements.txt
```

### 2. 运行回测

```bash
# 基础回测
python main.py --mode backtest --symbol BTCUSDT --days 30 --capital 10000

# 使用配置文件
python main.py --mode backtest --config config/strategy_config.yaml

# 自定义参数
python main.py --mode backtest \
  --symbol ETHUSDT \
  --days 60 \
  --capital 5000 \
  --min-confidence 70 \
  --min-score 7
```

### 3. 模拟交易

```bash
python main.py --mode live --config config/strategy_config.yaml --paper
```

### 4. 绩效分析

```bash
python main.py --mode analysis --trades-file trades.csv
```

---

## 配置参数说明

### 时间框架

```yaml
timeframes:
  confirmation: "1h"    # 趋势确认 - 用于判断大趋势方向
  primary: "15m"        # 主要交易 - 用于生成信号
  entry: "5m"           # 精确入场 - 用于优化入场点
```

### 趋势参数

```yaml
trend:
  ema_fast: 9           # 快线周期
  ema_slow: 21          # 慢线周期
  ema_trend: 50         # 趋势线周期
  adx_period: 14        # ADX周期
  adx_threshold: 25.0   # 趋势强度阈值 (>25认为有趋势)
```

### 动量参数

```yaml
momentum:
  rsi_period: 14
  rsi_overbought: 70.0  # RSI超买阈值
  rsi_oversold: 30.0    # RSI超卖阈值
  macd_fast: 12
  macd_slow: 26
  macd_signal: 9
```

### 风险管理

```yaml
risk_management:
  max_position_size: 0.10    # 最大仓位占账户10%
  max_leverage: 5.0          # 最大5倍杠杆
  risk_per_trade: 0.01       # 每笔交易风险1%
  max_daily_loss: 0.03       # 每日最大亏损3%
```

---

## 优化建议

### 1. 参数优化

#### BTC (趋势性强)
```python
config = StrategyConfig(
    atr_multiplier_sl=2.0,
    max_leverage=3,
    adx_threshold=25
)
```

#### ETH (波动适中)
```python
config = StrategyConfig(
    atr_multiplier_sl=2.5,
    max_leverage=4,
    adx_threshold=23
)
```

#### SOL (高波动)
```python
config = StrategyConfig(
    atr_multiplier_sl=3.0,
    max_leverage=2,
    adx_threshold=28
)
```

### 2. 组合策略

建议同时运行多个不同参数的策略：

```python
# 保守型
conservative = StrategyConfig(
    min_score=8.0,
    max_leverage=2,
    risk_per_trade=0.005
)

# 平衡型
balanced = StrategyConfig(
    min_score=6.5,
    max_leverage=3,
    risk_per_trade=0.01
)

# 激进型
aggressive = StrategyConfig(
    min_score=5.5,
    max_leverage=5,
    risk_per_trade=0.015
)
```

### 3. 多品种配置

```yaml
symbols:
  - BTCUSDT    # 核心持仓，40%资金
  - ETHUSDT    # 次要持仓，30%资金
  - SOLUSDT    # 卫星持仓，20%资金
  - BNBUSDT    # 卫星持仓，10%资金
```

---

## Web UI 使用

### 访问策略管理页面

打开 Web UI: https://6ffndykqj24qc.ok.kimi.link

点击左侧菜单 **"策略管理"** 进入策略页面。

### 页面功能

1. **概览标签**
   - 查看权益曲线
   - 查看关键指标
   - 查看最新信号

2. **信号历史标签**
   - 查看所有历史信号
   - 筛选不同状态信号
   - 查看信号详情

3. **绩效分析标签**
   - 做多/做空胜率对比
   - 出场原因分析
   - 盈亏统计

4. **参数配置标签**
   - 查看当前参数
   - 修改策略配置
   - 保存配置

### 启动/暂停策略

点击右上角 **"启动策略"** / **"暂停策略"** 按钮控制策略运行状态。

---

## 实盘交易注意事项

### 1. 前期准备

- [ ] 完成至少30天回测验证
- [ ] 模拟交易验证至少2周
- [ ] 确认API连接稳定
- [ ] 设置合理的初始资金

### 2. 风险控制

- [ ] 设置每日最大亏损限制
- [ ] 设置最大持仓数量
- [ ] 定期监控策略表现
- [ ] 准备应急处理方案

### 3. 监控指标

| 指标 | 警告阈值 | 危险阈值 |
|------|----------|----------|
| 胜率 | < 55% | < 50% |
| 盈亏比 | < 1.3 | < 1.0 |
| 最大回撤 | > 15% | > 25% |
| 夏普比率 | < 1.0 | < 0.5 |

### 4. 应急处理

```
情况1: 连续5笔亏损
→ 暂停策略，检查市场状态

情况2: 单日亏损超过3%
→ 停止当日交易

情况3: 最大回撤超过20%
→ 减仓50%，重新评估策略

情况4: 胜率持续低于50%
→ 回测验证，必要时调整参数
```

---

## 风险提示

1. **历史表现不代表未来收益**: 回测结果基于历史数据，实际交易可能存在差异
2. **市场风险**: 加密货币市场波动剧烈，可能产生重大损失
3. **技术风险**: 系统故障、网络延迟可能导致意外损失
4. **流动性风险**: 极端行情下可能无法按预期价格成交
5. **建议**: 先用模拟账户验证策略，再投入实盘资金

---

## 常见问题

### Q1: 策略适合什么市场环境？

A: 策略最适合**趋势明显**的市场环境，在强趋势中胜率可达70%+。在震荡区间表现一般，建议降低仓位或暂停交易。

### Q2: 需要多少资金起步？

A: 建议至少 **1000 USDT** 起步，以确保有足够的资金进行风险管理和仓位分配。

### Q3: 策略多久产生一次信号？

A: 平均 **2-3天** 产生一个信号，具体取决于市场状态和配置参数。高质量信号可能需要等待更长时间。

### Q4: 可以同时交易多个品种吗？

A: 可以，建议同时交易 **3-5个** 相关性较低的品种，以分散风险。

### Q5: 如何优化策略参数？

A: 建议按以下步骤优化：
1. 使用历史数据进行回测
2. 分析不同参数组合的表现
3. 选择夏普比率最高且最大回撤可接受的参数
4. 在模拟账户验证优化后的参数
5. 小资金实盘测试
6. 逐步增加资金

---

## 技术支持

如有问题或建议，欢迎提交 Issue 或 PR。

---

## 更新日志

### v1.0.0 (2026-02-24)
- 初始版本发布
- 实现多时间框架趋势动量策略
- 集成5层交易系统
- 添加Web UI管理界面
